{% extends "base.html" %}
{% block content %}

{% if user.is_authenticated %}

{% for name, url in breadcrumbs %}
 {% if not forloop.last %}
    <a href="{{ url }}" class="breadcrumb-link">{{ name }}</a>
{% else %}
 <span class="breadcrumb-link breadcrumb-active">{{ name }}</span>
{% endif %}
    {% if not forloop.last %}<span class="breadcrumb-separator">&gt;</span>{% endif %}
{% endfor %}

{% if student_obj %}

<div class="container second-call-page">

<h2>Другий Дзвінок</h2>

<div class="btn-group">
  <select class="form-control" id="operatorDropdown">
     <option value="">All Operators</option>
    {% for operator in operators %}
        <option value="{{ operator.username }}">{{ operator.username }}</option>
    {% endfor %}
  </select>
</div>

<table class="styled-table" >
  <thead>
    <tr>
      <th scope="col">ПІБ</th>
      <th scope="col">Номер Телефону</th>
        <th scope="col">Номер Телефону Батьків</th>
        <th scope="col">Школа</th>
        <th scope="col">Клас</th>
        <th scope="col">Дата додавання</th>
        <th scope="col">Перший дзвінок оператор</th>
        <th scope="col">Статус Першого Дзвінка</th>
        <th scope="col">Запис на пробне</th>
        <th scope="col">Статус Пробного</th>
        <th scope="col">Коментар Перший Дзвінок</th>

        <th scope="col">Другий дзвінок оператор</th>
        <th scope="col">Статус Другого Дзвінка</th>
        <th scope="col">Додати до групи</th>
        <th scope="col">Коментар Другий Дзвінок</th>
        <th scope="col">Редагувати</th>

    </tr>
  </thead>
  <tbody class="table-group-divider">
      {% if center_obj %}
        {% for student in student_obj %}
        <tr class="second-call-row" data-operator="{{ student.second_call }}">
          <td>{{ student.student_full_name }}</td>
          <td>{{ student.student_phone_number }}</td>
          <td>{{ student.parent_phone_number }}</td>
            <td>{{ student.school }}</td>
            <td>{{ student.class_number }}</td>
            <td>{{ student.student_add_date}}</td>

            <td>{{ student.first_call |default_if_none:""}}</td>
            <td>{{ student.first_call_satus |default_if_none:""}}</td>
            <td>{{ student.trial_registration |default_if_none:""}}</td>
            <td>{{ student.trial_status|default_if_none:"" }}</td>
            <td>{{ student.comment_first_call|default_if_none:"" }}</td>

            <td>{{ student.second_call |default_if_none:""}}</td>
            <td>{{ student.second_call_satus |default_if_none:""}}</td>
            <td>{{ student.add_to_group |default_if_none:""}}</td>
            <td>{{ student.comment_second_call |default_if_none:""}}</td>
            <td><a href="{% url 'student_update_second' pk=student.pk %}">
            <button type="button" class="btn btn-link">Змінити</button>
          </a></td>
        </tr>
        {% endfor %}
      {% endif %}
    </tbody>
  </table>
</div>
{% else %}
    <h2>Немає учнів для дзвінка</h2>

{% endif %}
<script>
  window.onload = function() {
    var dropdown = document.querySelector('.form-control');
    dropdown.addEventListener('change', function() {
        var operatorUsername = this.options[this.selectedIndex].value.trim().toLowerCase();
        var rows = document.querySelectorAll('.second-call-row');
        rows.forEach(function(row) {
            var rowOperator = row.dataset.operator.trim().toLowerCase();
            if (operatorUsername === "" || rowOperator === operatorUsername) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        });
    });
};
</script>
{% endif %}
{% endblock content %}


