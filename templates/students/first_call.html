{% extends "base.html" %}
{% block content %}

{% if user.is_authenticated %}

{% for name, url in breadcrumbs %}
 {% if not forloop.last %}
    <a href="{{ url }}" class="breadcrumb-link">{{ name }}</a>
{% else %}
 <span class="breadcrumb-link breadcrumb-active">{{ name }}</span>
{% endif %}
    {% if not forloop.last %}<span class="breadcrumb-separator">&gt;</span>{% endif %}
{% endfor %}


{% if student_obj %}
<div class="container">

<h2>Перший Дзвінок</h2>

 <!-- filter for Operators -->
<div class="filter-container">
    <div class="btn-group">
        <select class="form-control" id="operatorDropdown">
             <option value="">Оператори</option>
            {% for operator in operators %}
                <option value="{{ operator.username }}">{{ operator.username }}</option>
            {% endfor %}
        </select>
    </div>

<!-- filter for "Статус першого дзвінка" -->
     <div class="btn-group">
        <select id="status-filter" class="form-control">
            <option value="">Статус першого дзвінка</option>
            <option value="Так, прийдуть на пробне">Так, прийдуть на пробне</option>
            <option value="Ні">Ні</option>
            <option value="Думають">Думають</option>
            <option value="Невірний номер">Невірний номер</option>
            <option value="На наступний тиждень">На наступний тиждень</option>
            <option value="Передзвонити пізніше">Передзвонити пізніше</option>
            <option value="Примітка">Примітка</option>
            <option value="Не беруть телефон">Не беруть телефон</option>
        </select>
    </div>
</div>


<table class="styled-table">
  <thead>
    <tr>
        <th scope="col">ID</th>
        <th scope="col">ПІБ</th>
        <th scope="col">Номер Телефону</th>
        <th scope="col">Номер Телефону Батьків</th>
        <th scope="col">ПІБ Батьків</th>
        <th scope="col">Школа</th>
        <th scope="col">Клас</th>
<!--        <th scope="col">Дата додавання</th>-->
        <th scope="col">Перший дзвінок</th>
        <th scope="col">Статус Першого Дзвінка</th>
        <th scope="col">Запис на пробне</th>
        <th scope="col">Статус Пробного</th>
        <th scope="col">Коментар</th>
        <th scope="col">Редагувати</th>
    </tr>
  </thead>
  <tbody class="table-group-divider">
      {% if center_obj %}
        {% for student in student_obj %}
        <tr class="first-call-row active-row" data-operator="{{ student.first_call }}">
            <td>{{ student.pk }}</td>
            <td>{{ student.student_full_name |default_if_none:""}}</td>
            <td>{{ student.student_phone_number |default_if_none:""}}</td>
            <td>{{ student.parent_phone_number |default_if_none:""}}</td>
            <td>{{ student.parent_full_name |default_if_none:""}}</td>
            <td>{{ student.school|default_if_none:""}}</td>
            <td>{{ student.class_number|default_if_none:""}}</td>
<!--            <td>{{ student.student_add_date|default_if_none:""}}</td>-->
            <td>{{ student.first_call|default_if_none:""}}</td>
            <td>{{ student.first_call_satus|default_if_none:""}}</td>
            <td>{{ student.trial_registration|default_if_none:""}}</td>
            <td>{{ student.trial_status|default_if_none:""}}</td>
            <td>{{ student.comment_first_call|default_if_none:""}}</td>
            <td>
            <a href="{% url 'student_update' pk=student.pk %}">
            <button type="button" class="btn btn-link">Змінити</button></a>
          </td>
        </tr>
        {% endfor %}
      {% endif %}
    </tbody>
  </table>
</div>
{% else %}

    <h2>Немає учнів для дзвінка :(</h2>

{% endif %}
<script>
window.onload = function() {
    var operatorDropdown = document.querySelector('#operatorDropdown');
    var statusFilter = document.querySelector('#status-filter');
    var rows = document.querySelectorAll('.first-call-row');

    operatorDropdown.addEventListener('change', filterRows);
    statusFilter.addEventListener('change', filterRows);

    function filterRows() {
        var operatorUsername = operatorDropdown.value.trim().toLowerCase();
        var selectedStatus = statusFilter.value.trim();

        rows.forEach(function(row) {
            var rowOperator = row.dataset.operator.trim().toLowerCase();
            var statusCell = row.querySelector('td:nth-child(8)').textContent.trim(); // Adjust the index if needed

            if ((operatorUsername === "" || rowOperator === operatorUsername) &&
                (selectedStatus === "" || statusCell === selectedStatus)) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        });
    }
};
</script>
{% endif %}
{% endblock content %}